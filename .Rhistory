snp_df <- readr::read_tsv(snp_file, col_names = F)
head(snp_df)
snp_bed <- snp_df %>%
mutate(pos = as.numeric(pos)) %>%
transmute(
chr = `#chr`,
start = pos - 1,   # convert to 0-based
end = pos,         # SNP occupies 1 bp
snp_id = snp_id,
variation = variation,
strand = "*",
clinical_significance = clinical_significance,
function_class = function_class,
gene = gene
) %>%
filter(!is.na(start) & !is.na(gene))
## snp
snp_df <-  readr::read_tsv("/Users/hannalee2002/Downloads/snp_result_pathogenic_PubMed_Cited.txt")
snp_bed <- snp_df %>%
mutate(pos = as.numeric(pos)) %>%
transmute(
chr = `#chr`,
start = pos - 1,   # convert to 0-based
end = pos,         # SNP occupies 1 bp
snp_id = snp_id,
variation = variation,
strand = "*",
clinical_significance = clinical_significance,
function_class = function_class,
gene = gene
) %>%
filter(!is.na(start) & !is.na(gene))
# filter for random 55 SNP
snp_filtered <-dplyr::slice(snp_bed, 1:55)
write.table(
snp_filtered,
file = "/Users/hannalee2002/Packages/m6ASeqTools/inst/extdata/dbSNP_human_subset.bed",
sep = "\t",
quote = FALSE,
row.names = FALSE,
col.names = FALSE
)
snp_file <- system.file("extdata", "dbSNP_human_subset.bed", package = "m6ASeqTools")
head(snp_df)
# set columns
colnames(snp_df) <- c(
"chr",                  # Chromosome of the SNP
"start",                # Start position (0-based)
"end",                  # End position (1-based; SNP occupies 1 bp)
"snp_id",               # Unique SNP identifier
"variation",            # Allele variation (e.g., A>G)
"strand",               # Strand information (usually "*" for SNPs)
"clinical_significance",# Clinical annotation of the SNP (e.g., benign, pathogenic)
"function_class",       # Functional classification (e.g., exonic, intronic)
"gene"                  # Associated gene symbol or ID
)
# filter for random 55 SNP
snp_filtered <-dplyr::slice(snp_bed, 1:55)
write.table(
snp_filtered,
file = "/Users/hannalee2002/Packages/m6ASeqTools/inst/extdata/dbSNP_human_subset.bed",
sep = "\t",
quote = FALSE,
row.names = FALSE,
col.names = FALSE
)
devtools::load_all()
snp_file <- system.file("extdata", "dbSNP_human_subset.bed", package = "m6ASeqTools")
snp_df <- readr::read_tsv(snp_file, col_names = F)
# set columns
colnames(snp_df) <- c(
"chr",                  # Chromosome of the SNP
"start",                # Start position (0-based)
"end",                  # End position (1-based; SNP occupies 1 bp)
"snp_id",               # Unique SNP identifier
"variation",            # Allele variation (e.g., A>G)
"strand",               # Strand information (usually "*" for SNPs)
"clinical_significance",# Clinical annotation of the SNP (e.g., benign, pathogenic)
"function_class",       # Functional classification (e.g., exonic, intronic)
"gene"                  # Associated gene symbol or ID
)
naive1 <- read.csv("/Users/hannalee2002/hl_cell-lines-project/m6A/m6A_output/individual_m6anet_output/RNA_cell_naive1/data.site_proba_split.csv")
naive2 <- read.csv("/Users/hannalee2002/hl_cell-lines-project/m6A/m6A_output/individual_m6anet_output/RNA_cell_naive2/data.site_proba_split.csv")
naive3 <- read.csv("/Users/hannalee2002/hl_cell-lines-project/m6A/m6A_output/individual_m6anet_output/RNA_cell_naive3/data.site_proba_split.csv")
igf1 <- read.csv("/Users/hannalee2002/hl_cell-lines-project/m6A/m6A_output/individual_m6anet_output/RNA_cell_igf1/data.site_proba_split.csv")
igf2 <- read.csv("/Users/hannalee2002/hl_cell-lines-project/m6A/m6A_output/individual_m6anet_output/RNA_cell_igf2/data.site_proba_split.csv")
igf3 <- read.csv("/Users/hannalee2002/hl_cell-lines-project/m6A/m6A_output/individual_m6anet_output/RNA_cell_igf3/data.site_proba_split.csv")
devtools::load_all()
naive1_tx <- map_relative_tx_regions_to_m6A(naive1,tx_df)
naive2_tx <- map_relative_tx_regions_to_m6A(naive2,tx_df)
naive3_tx <- map_relative_tx_regions_to_m6A(naive3,tx_df)
igf1_tx <- map_relative_tx_regions_to_m6A(igf1,tx_df)
igf2_tx <- map_relative_tx_regions_to_m6A(igf2,tx_df)
igf3_tx <- map_relative_tx_regions_to_m6A(igf3,tx_df)
naive1_wmr <- calculate_weighted_mod_ratio(naive1_tx)
naive2_wmr <- calculate_weighted_mod_ratio(naive2_tx)
naive3_wmr <- calculate_weighted_mod_ratio(naive3_tx)
igf1_wmr <- calculate_weighted_mod_ratio(igf1_tx)
igf2_wmr <- calculate_weighted_mod_ratio(igf2_tx)
igf3_wmr <- calculate_weighted_mod_ratio(igf3_tx)
# tx regions
# Path to GTF annotation file
gtf_path <- "/Users/hannalee2002/references/gencode/v45/gencode.v45.primary_assembly.annotation.gtf"
# Step 1: Extract transcript region lengths (5'UTR, CDS, 3'UTR)
tx_df <- get_transcript_region_lengths(gtf_path)
naive1_tx <- map_relative_tx_regions_to_m6A(naive1,tx_df)
naive2_tx <- map_relative_tx_regions_to_m6A(naive2,tx_df)
naive3_tx <- map_relative_tx_regions_to_m6A(naive3,tx_df)
igf1_tx <- map_relative_tx_regions_to_m6A(igf1,tx_df)
igf2_tx <- map_relative_tx_regions_to_m6A(igf2,tx_df)
igf3_tx <- map_relative_tx_regions_to_m6A(igf3,tx_df)
naive1_wmr <- calculate_weighted_mod_ratio(naive1_tx)
naive2_wmr <- calculate_weighted_mod_ratio(naive2_tx)
naive3_wmr <- calculate_weighted_mod_ratio(naive3_tx)
igf1_wmr <- calculate_weighted_mod_ratio(igf1_tx)
igf2_wmr <- calculate_weighted_mod_ratio(igf2_tx)
igf3_wmr <- calculate_weighted_mod_ratio(igf3_tx)
naive_list <- list(naive1_wmr, naive2_wmr, naive3_wmr)
igf_list <- list(igf1_wmr, igf2_wmr, igf3_wmr)
diff_test_igf_naive <- run_wmr_differential_test(
condition1_list = naive_list,
condition2_list = igf_list,
condition1_name = "NAIVE",
condition2_name = "IGF"
)
View(diff_test_igf_naive)
## run weighted_mod_ratio_and_DGE on igf_vs_naive
diff_test_dge <- weighted_mod_ratio_and_DGE(wmr_df = diff_test_igf_naive,
deseq = igf_vs_naive_DGE,
input_type = "wmr_diff",
wmr_sig = list(p_value = 0.1),
deseq_gene_col = "ensembl_gene_id_version",
log2fc_col = "igf_vs_naive_log2FC",
padj_col = "pvalue_igf_vs_naive",
group1_name = "NAIVE",
group2_name = "IGF")
igf_vs_naive_DGE <- read.csv("/Users/hannalee2002/hl_cell-lines-project/DESeq/DESeq_KD_Naive/KD_Naive_Gene_DESeq.csv")
## run weighted_mod_ratio_and_DGE on igf_vs_naive
diff_test_dge <- weighted_mod_ratio_and_DGE(wmr_df = diff_test_igf_naive,
deseq = igf_vs_naive_DGE,
input_type = "wmr_diff",
wmr_sig = list(p_value = 0.1),
deseq_gene_col = "ensembl_gene_id_version",
log2fc_col = "igf_vs_naive_log2FC",
padj_col = "pvalue_igf_vs_naive",
group1_name = "NAIVE",
group2_name = "IGF")
p<-diff_test_dge$plot
ggsave("diff_test_plot_igf_vs_naive_supp.pdf",p)
diff_test_dge_biotypes <- diff_test_dge$data
View(diff_test_dge_biotypes)
diff_test_dge_df <- diff_test_dge$data
# run summary function
summary_diff_test_wmr <- summarize_wmr_dge_with_replicates(
df = diff_test_dge_df,
group1_name = "Naive", # Control
group2_name = "IGF", # Experimental
log2FC_dge = "igf_vs_naive_log2FC",
diff_wmr = "median_diff",
dge_sig = "dge_sig",
wmr_sig = "wmr_sig"
)
devtools
devtools::load_all()
# run summary function
summary_diff_test_wmr <- summarize_wmr_dge_with_replicates(
df = diff_test_dge_df,
group1_name = "Naive", # Control
group2_name = "IGF", # Experimental
log2FC_dge = "igf_vs_naive_log2FC",
diff_wmr = "median_diff",
dge_sig = "dge_sig",
wmr_sig = "wmr_sig"
)
# qPCR analysis
# Read the file, skipping the first 7 rows of metadata
data <- read.csv("/Users/hannalee2002/Downloads/PP_RNA_spec_primers_YTH_FTO_KDs_12_15_25_data.xls",
skip = 7,
header = TRUE,
stringsAsFactors = FALSE)
# qPCR analysis
# Read the file, skipping the first 7 rows of metadata
library(readxl)
data <- read.xls("/Users/hannalee2002/Downloads/PP_RNA_spec_primers_YTH_FTO_KDs_12_15_25_data.xls",
skip = 7,
header = TRUE,
stringsAsFactors = FALSE)
# qPCR analysis
# Read the file, skipping the first 7 rows of metadata
library(readxl)
data <- read.xls("/Users/hannalee2002/Downloads/PP_RNA_spec_primers_YTH_FTO_KDs_12_15_25_data.xls",
skip = 7,
header = TRUE,
stringsAsFactors = FALSE)
data <- read_xls("/Users/hannalee2002/Downloads/PP_RNA_spec_primers_YTH_FTO_KDs_12_15_25_data.xls",
skip = 7,
header = TRUE,
stringsAsFactors = FALSE)
data <- read_xls("/Users/hannalee2002/Downloads/PP_RNA_spec_primers_YTH_FTO_KDs_12_15_25_data.xls",
skip = 7)
View(data)
data$run_id <- "RNA_spec_primers_YTH_FTO_KDs_12_15_25"
head(data)
# select necessary columns
data_filt <- data %>%
dplyr::select(run_id,
well,
sample_name = "Sample Name")
# select necessary columns
data_filt <- data %>%
dplyr::select(run_id,
well = Well,
sample_name = "Sample Name")
dplyr::select(run_id,
well = Well,
sample_name = "Sample Name",
target_name = "Target Name",
reporter = Reporter,
CT = "Cт"
avg_CT = "Cт Mean",
std_CT = "Cт SD")
# select necessary columns
data_filt <- data %>%
filter(`Sample Name` == "NTC") %>%
dplyr::select(run_id,
well = Well,
sample_name = "Sample Name",
target_name = "Target Name",
reporter = Reporter,
CT = "Cт"
avg_CT = "Cт Mean",
std_CT = "Cт SD")
# select necessary columns
data_filt <- data %>%
filter(`Sample Name` == "NTC") %>%
dplyr::select(run_id,
well = Well,
sample_name = "Sample Name",
target_name = "Target Name",
reporter = Reporter,
CT = "Cт",
avg_CT = "Cт Mean",
std_CT = "Cт SD")
# select necessary columns
data_filt <- data %>%
filter(`Sample Name` == "NTC") %>%  # filter out NTCs
dplyr::select(run_id,
well = Well,
sample_name = "Sample Name",
target_name = "Target Name",
reporter = Reporter,
CT = "Cт",
avg_CT = "Cт Mean",
std_CT = "Cт SD")  %>% # select necessary columns
group_by(sample_name, target_name) %>%
mutate(rep = row_number()) %>%
ungroup() %>%
tidyr::pivot_wider(
names_from = rep,
values_from = CT,
names_prefix = "Ct_rep"
)
View(data_filt)
# select necessary columns
data_filt <- data %>%
filter(`Sample Name` != "NTC") %>%  # filter out NTCs
dplyr::select(run_id,
well = Well,
sample_name = "Sample Name",
target_name = "Target Name",
reporter = Reporter,
CT = "Cт",
avg_CT = "Cт Mean",
std_CT = "Cт SD")  %>% # select necessary columns
group_by(sample_name, target_name) %>%
mutate(rep = row_number()) %>%
ungroup() %>%
tidyr::pivot_wider(
names_from = rep,
values_from = CT,
names_prefix = "Ct_rep"
)
View(data_filt)
# select necessary columns
data_filt <- data %>%
filter(`Sample Name` != "NTC") %>%  # filter out NTCs
dplyr::select(run_id,
sample_name = "Sample Name",
target_name = "Target Name",
reporter = Reporter,
CT = "Cт",
avg_CT = "Cт Mean",
std_CT = "Cт SD")  %>% # select necessary columns
group_by(sample_name, target_name) %>%
mutate(rep = row_number()) %>%
ungroup() %>%
tidyr::pivot_wider(
names_from = rep,
values_from = CT,
names_prefix = "Ct_rep"
)
library(readxl)
library(dplyr)
library(tidyr)
file <- "/Users/hannalee2002/Downloads/master_spreadsheet_all_qPCR_results_HL.xlsx"
# Get sheet names
sheets <- excel_sheets(file)
# Read all sheets into a list of dataframes with run_id
dfs <- lapply(sheets, function(sh) {
df <- read_xls(file, sheet = sh, skip = 7, range = cell_cols("A:W"))
df$run_id <- sh
df
})
library(openxlsx)
install.packages("openxlsx")
library(openxlsx)
# Read all sheets into a list of dataframes with run_id
dfs <- lapply(sheets, function(sh) {
df <- read_xls(file, sheet = sh, skip = 7, range = cell_cols("A:W"))
df$run_id <- sh
df
})
# Read all sheets into a list of dataframes with run_id
dfs <- lapply(sheets, function(sh) {
df <- read_xlsx(file, sheet = sh, skip = 7, range = cell_cols("A:W"))
df$run_id <- sh
df
})
# Read all sheets into a list of dataframes with run_id
dfs <- lapply(sheets, function(sh) {
df <- read_xlsx(file, sheet = sh, skip = 7, range = cell_cols("A:W"), col_names = TRUE)
df <- df %>% select(where(~ !all(is.na(.))))  # remove empty columns
df$run_id <- sh
df
})
View(dfs)
View(dfs[[1]])
devtools::load_all()
# run summary function
summary_diff_test_wmr <- summarize_wmr_dge_with_replicates(
df = diff_test_dge_df,
group1_name = "Naive", # Control
group2_name = "IGF", # Experimental
log2FC_dge = "igf_vs_naive_log2FC",
diff_wmr = "median_diff",
dge_sig = "dge_sig",
wmr_sig = "wmr_sig"
)
devtools::load_all()
# run summary function
summary_diff_test_wmr <- summarize_wmr_dge_with_replicates(
df = diff_test_dge_df,
group1_name = "Naive", # Control
group2_name = "IGF", # Experimental
log2FC_dge = "igf_vs_naive_log2FC",
diff_wmr = "median_diff",
dge_sig = "dge_sig",
wmr_sig = "wmr_sig"
)
View(summary_diff_test_wmr)
View(summary_diff_test_wmr[["biotype_summary_all"]])
head(summary_diff_test_wmr)
summary_diff_test_wmr_biotype <- summary_diff_test_wmr$biotype_summary_all
head(summary_diff_test_wmr_biotype)
unique(summary_diff_test_wmr_biotype$group)
# plot for no sig dge, no sig m6a
summary_diff_test_wmr_biotype_NS <- summary_diff_test_wmr_biotype %>%
filter(group %in% c("noDGE_not_sig_hyperm6A_group2",
"noDGE_not_sig_hyperm6A_group1"))
View(summary_diff_test_wmr_biotype_NS)
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
theme_ipsum() +
xlab("")
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
xlab("")
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggsave("diff_test_plot_igf_vs_naive_supp.pdf",p)
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity")
install.packages("pals")
library(pals)
colos <-
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
scale_color_manual(values=unname(glasbey()))
colos <-
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_color_manual(values=unname(glasbey()))
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_color_manual(values=unname(glasbey()))
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_color_manual(values=unname(pals::glasbey()))
# Choose a palette with enough colors for your biotypes
my_colors <- glasbey(length(unique(summary_diff_test_wmr_biotype_NS$gene_biotype)))
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
scale_fill_manual(values = my_colors) +
theme_minimal()
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = my_colors) +
theme_minimal()
# Choose a palette with enough colors for your biotypes
my_colors <- cols25(length(unique(summary_diff_test_wmr_biotype_NS$gene_biotype)))
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = my_colors) +
theme_minimal()
p<- ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = my_colors) +
theme_minimal()
ggsave("biotype_summary_for_diff_test_dge_igf_naive.pdf", p)
summary_diff_test_wmr_biotype_Sig <- summary_diff_test_wmr_biotype %>%
filter(!group %in% c("noDGE_not_sig_hyperm6A_group2",
"noDGE_not_sig_hyperm6A_group1"))
my_colors <- cols25(length(unique(summary_diff_test_wmr_biotype_Sig$gene_biotype)))
ggplot(summary_diff_test_wmr_biotype_Sig, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = my_colors) +
theme_minimal()
unique(summary_diff_test_wmr_biotype$gene_biotype)
# Choose a palette with enough colors for your biotypes
# Get all unique biotypes
biotypes <- unique(summary_diff_test_wmr_biotype$gene_biotype)
# Assign a distinct Glasbey color to each biotype
biotype_colors <- setNames(cols25(length(biotypes)), biotypes)
ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = biotype_colors) +
theme_minimal()
ggsave("biotype_summary_for_diff_test_dge_igf_naive.pdf", p)
p<- ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = biotype_colors) +
theme_minimal()
ggsave("biotype_summary_for_diff_test_dge_igf_naive.pdf", p)
ggplot(summary_diff_test_wmr_biotype_Sig, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = my_colors) +
theme_minimal()
p <- ggplot(summary_diff_test_wmr_biotype_Sig, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = my_colors) +
theme_minimal()
ggsave("biotype_summary_for_diff_test_dge_igf_naive.pdf_Sig", p)
p<- ggplot(summary_diff_test_wmr_biotype_NS, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = biotype_colors) +
theme_minimal()
ggsave("biotype_summary_for_diff_test_dge_igf_naive_NS.pdf", p)
p <- ggplot(summary_diff_test_wmr_biotype_Sig, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = my_colors) +
theme_minimal()
ggsave("biotype_summary_for_diff_test_dge_igf_naive.pdf_Sig.pdf", p)
p <- ggplot(summary_diff_test_wmr_biotype_Sig, aes(fill=gene_biotype, y=count, x=group)) +
geom_bar(position="stack", stat="identity") +
ggplot2::scale_fill_manual(values = biotype_colors) +
theme_minimal()
ggsave("biotype_summary_for_diff_test_dge_igf_naive.pdf_Sig.pdf", p)
ggsave("biotype_summary_for_diff_test_dge_igf_naive.pdf_Sig.pdf", p, height = 6.94, width = 9.61)
browseVignettes("m6ASeqTools")
devtools::install()
vignette("m6AnetAnalyzer")
browseVignettes("m6ASeqTools")
browseVignettes("m6AnetAnalyzer")
devtools::build(vignettes = TRUE)
browseVignettes("m6AnetAnalyzer")
devtools::install()
browseVignettes("m6AnetAnalyzer")
remove.packages("m6AnetAnalyzer")
devtools::install(build_vignettes = TRUE)
vignette("Introduction to m6AnetAnalyzer", package = "m6AnetAnalyzer")
browseVignettes("m6AnetAnalyzer")
browseVignettes("m6AnetAnalyzer")
data <- read_xls("/Users/hannalee2002/hl_cell-lines-project/PP_all_qpcr_results/KF_ALK_Mettl14_Isoform_Primers_12_15_25_data.xls",
skip = 7)
library(readxl)
library(dplyr)
library(tidyr)
library(openxlsx)
data <- read_xls("/Users/hannalee2002/hl_cell-lines-project/PP_all_qpcr_results/KF_ALK_Mettl14_Isoform_Primers_12_15_25_data.xls",
skip = 7)
data$run_id <- "KF_ALK_Mettl14_Isoform_Primers_12_15_25_data"
View(data)
# select necessary columns
data_filt <- data %>%
filter(`Sample Name` != "NTC") %>%  # filter out NTCs
dplyr::select(run_id,
sample_name = "Sample Name",
target_name = "Target Name",
reporter = Reporter,
CT = "Cт",
avg_CT = "Cт Mean",
std_CT = "Cт SD")  %>% # select necessary columns
group_by(sample_name, target_name) %>%
mutate(rep = row_number()) %>%
ungroup() %>%
tidyr::pivot_wider(
names_from = rep,
values_from = CT,
names_prefix = "Ct_rep"
)
View(data_filt)
View(data_filt)
